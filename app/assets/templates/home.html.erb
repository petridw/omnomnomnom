
<!-- -------------------- Search Form -------------------- -->
<section class="row">
  <form>

    <!-- keywords input -->
    <div class="form-group col-sm-6 col-sm-offset-3">
      <label for="keywords" class="sr-only">Keywords</label>
      <input type="text" ng-model="vm.keywords" name="keywords" autofocus class="form-control" placeholder="Recipe name or keyword">
    </div>

    <div ng-if="vm.ingredients.length > 0" ng-repeat="ingredient in vm.ingredients" class="form-group col-sm-6 col-sm-offset-3 text-center">
      {{ingredient}}
    </div>

    <!-- ingredients input -->
    <div class="form-group col-sm-5 col-sm-offset-3 text-center">
      <label for="ingredients" class="sr-only">Ingredients</label>
<!--       <input type="text" ng-model="vm.ingredient" name="ingredient" class="form-control" placeholder="Ingredient to include, e.g. butter"> -->
      <input type="text" ng-model="vm.ingredient" typeahead="ingredient as ingredient.searchValue for ingredient in vm.ingredientsData | filter:$viewValue | limitTo:10" typeahead-on-select="vm.onSelect($item, $model, $label)" class="form-control" placeholder="Ingredient to include, e.g. butter">
      <!-- <input type="text" ng-model="customSelected" placeholder="Custom template" typeahead="state as state.name for state in statesWithFlags | filter:{name:$viewValue}" typeahead-template-url="customTemplate.html" class="form-control"> -->

    </div>
    <div class="form-group col-sm-1 text-right">
      <button ng-click="!vm.ingredient || vm.addIngredient()" class="btn btn-default text-center">
        <i class="fa fa-plus"></i>
      </button>
    </div>

    <!-- submit form -->
    <div class="form-group col-sm-6 col-sm-offset-3 text-center">
      <button type="submit" ng-click="vm.search()" class="btn btn-primary btn-lg">
        get cooking <i class="fa fa-cutlery"></i>
      </button>
    </div>
  </form>
</section>

<!-- -------------------- Spinner -------------------- -->
<section ng-if="vm.loading" class="row">
  <div class="col-sm-2 col-sm-offset-5 text-center spinner">
    <p>Finding you something sweet sweet like bear meat</p>
    <i class="fa fa-spinner fa-pulse fa-4x"></i>
  </div>
</section>

<!-- -------------------- List of Recipes -------------------- -->
<section ng-if="vm.searchResults" class="row text-center">

  <!-- selected-card class can override all normal card styles bc of specificity of the css selector -->
  <div  ng-repeat="(key, recipe) in vm.recipes" 
        ng-class="{true: 'selected-card col-lg-6 col-md-8 col-sm-12', false: 'col-lg-3 col-md-4 col-sm-6'}[recipe.isSelected]">
    <div class="card" ng-click="vm.clickRecipe(key)">

      <!-- only displayed when the card is unselected -->
      <div class="card-narrow" ng-if="!recipe.isSelected" >

        <!-- !!! change header so that image and text are side by side taking up half the space in the card -->
        <div class="card-header">
          <div class="card-image">
            <img class="" ng-src="{{ recipe['imageUrlsBySize']['90'] || vm.noImageUrl }}" alt="{{recipe.recipeName}} image" >
          </div>
          <div class="card-title">
            {{recipe.recipeName}}
            <p>{{ recipe.sourceDisplayName }}</p>
          </div>
        </div>
        <div class="card-info">
          <!-- !!! change rating to display as gold/gray stars -->
          <div class="card-rating">
            Rating: {{recipe.rating}}
          </div>
          <div class="card-ingredients">
            <p>
              <!-- !!! change indexOf check to a hasIngredient check -->
              <span ng-class="{'have-ingredient': vm.hasIngredient(ingredient)}" ng-repeat="ingredient in recipe.ingredients">{{ingredient}} </span>
            </p>
          </div>
        </div>
      </div>

      <!-- only displayed when this card is selected -->
      <div class="card-wide" ng-if="recipe.isSelected">
        
        <!-- show spinner while api call still running -->
        <div ng-if="recipe.isLoading" class="text-center spinner">
          <p>Hold up a sec while we wrangle this recipe</p>
          <i class="fa fa-spinner fa-pulse fa-4x"></i>
        </div>

        <!-- show card content once it's loaded -->
        <div ng-if="!recipe.isLoading">

          <div class="card-header">
            <img ng-src="{{ recipe.expandedInfo.images[0].imageUrlsBySize['360'] || vm.noImageUrl }}" alt="{{recipe.recipeName}} large image">
            <div class="card-header-text">
              <h4>{{recipe.recipeName}}</h4>
              <a  ng-click="$event.stopPropagation();" ng-href="{{ recipe.expandedInfo.source.sourceRecipeUrl }}">
                <p>View recipe steps at {{recipe.sourceDisplayName}}</p>
              </a>
            </div>
          </div>

        </div>

      </div>


    </div>
  </div>
</section>
